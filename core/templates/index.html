<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Archivist - Video Transcription Service</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #1a1a1a;
            color: #e0e0e0;
        }
        .card {
            background-color: #2d2d2d;
            border: 1px solid #404040;
        }
        .btn-primary {
            background-color: #4a5568;
            color: white;
        }
        .btn-primary:hover {
            background-color: #2d3748;
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <header class="text-center mb-12">
            <h1 class="text-4xl font-bold mb-4">Archivist</h1>
            <p class="text-xl text-gray-400">Video Transcription Service</p>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- File Browser -->
            <div class="card rounded-lg p-6">
                <h2 class="text-2xl font-semibold mb-4">File Browser</h2>
                <div id="file-browser" class="min-h-[300px] border border-gray-700 rounded p-4">
                    <div class="flex items-center mb-4">
                        <input type="text" id="current-path" class="flex-grow bg-gray-800 text-gray-300 px-3 py-2 rounded" readonly>
                        <button onclick="navigateUp()" class="btn-primary px-4 py-2 rounded ml-2">â†‘</button>
                    </div>
                    <div id="file-list" class="space-y-2"></div>
                </div>
            </div>

            <!-- Queue -->
            <div class="card rounded-lg p-6">
                <h2 class="text-2xl font-semibold mb-4">Processing Queue</h2>
                <div id="queue" class="min-h-[300px] space-y-4"></div>
            </div>
        </div>
    </div>

    <script>
        let currentPath = '';

        // Load initial file list
        loadFiles();

        // Load files from current path
        function loadFiles() {
            fetch(`/api/browse?path=${encodeURIComponent(currentPath)}`)
                .then(response => response.json())
                .then(items => {
                    const fileList = document.getElementById('file-list');
                    document.getElementById('current-path').value = currentPath || '/';
                    
                    fileList.innerHTML = items.map(item => `
                        <div class="flex items-center justify-between p-2 hover:bg-gray-700 rounded cursor-pointer"
                             onclick="${item.type === 'directory' ? `navigate('${item.path}')` : `transcribe('${item.path}')`}">
                            <span>${item.name}</span>
                            <span class="text-sm text-gray-400">${item.type === 'file' ? item.size : ''}</span>
                        </div>
                    `).join('');
                });
        }

        // Navigate to directory
        function navigate(path) {
            currentPath = path;
            loadFiles();
        }

        // Navigate up one directory
        function navigateUp() {
            if (currentPath) {
                currentPath = currentPath.split('/').slice(0, -1).join('/');
                loadFiles();
            }
        }

        // Start transcription
        function transcribe(path) {
            fetch('/api/transcribe', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ path })
            })
            .then(response => response.json())
            .then(data => {
                if (data.job_id) {
                    updateQueue();
                }
            });
        }

        // Update queue display
        function updateQueue() {
            fetch('/api/queue')
                .then(response => response.json())
                .then(jobs => {
                    const queue = document.getElementById('queue');
                    queue.innerHTML = jobs.map(job => `
                        <div class="card p-4 space-y-2">
                            <div class="flex justify-between items-center">
                                <span class="font-medium">${job.video_path.split('/').pop()}</span>
                                <span class="px-2 py-1 rounded text-sm ${getStatusClass(job.status)}">${job.status}</span>
                            </div>
                            ${job.progress ? `
                            <div class="w-full bg-gray-700 rounded-full h-2.5">
                                <div class="bg-blue-600 h-2.5 rounded-full" style="width: ${job.progress}%"></div>
                            </div>
                            ` : ''}
                            <div class="text-sm text-gray-400">${job.status_message || ''}</div>
                            <div class="flex space-x-2">
                                ${getJobControls(job)}
                            </div>
                        </div>
                    `).join('');
                });
        }

        // Get status-specific CSS classes
        function getStatusClass(status) {
            const classes = {
                'queued': 'bg-gray-600',
                'processing': 'bg-blue-600',
                'paused': 'bg-yellow-600',
                'completed': 'bg-green-600',
                'failed': 'bg-red-600'
            };
            return classes[status] || 'bg-gray-600';
        }

        // Get job control buttons
        function getJobControls(job) {
            if (job.status === 'processing') {
                return `
                    <button onclick="controlJob('pause', '${job.id}')" class="btn-primary px-3 py-1 rounded text-sm">Pause</button>
                    <button onclick="controlJob('stop', '${job.id}')" class="btn-primary px-3 py-1 rounded text-sm">Stop</button>
                `;
            } else if (job.status === 'paused') {
                return `
                    <button onclick="controlJob('resume', '${job.id}')" class="btn-primary px-3 py-1 rounded text-sm">Resume</button>
                    <button onclick="controlJob('stop', '${job.id}')" class="btn-primary px-3 py-1 rounded text-sm">Stop</button>
                `;
            }
            return '';
        }

        // Control job (pause/resume/stop)
        function controlJob(action, jobId) {
            fetch(`/api/queue/${action}/${jobId}`, { method: 'POST' })
                .then(response => response.json())
                .then(() => updateQueue());
        }

        // Update queue every 5 seconds
        setInterval(updateQueue, 5000);
        updateQueue();
    </script>
</body>
</html> 